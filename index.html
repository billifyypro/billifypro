<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Billify Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #0b0e14; --bg-card: #151a23; --text-main: #f8fafc; --accent: #3b82f6; --success: #22c55e; --warning: #eab308; --danger: #ef4444; --border: #27272a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg-dark); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        .mobile-header { position: fixed; top: 0; left: 0; right: 0; height: 60px; background: var(--bg-card); border-bottom: 1px solid var(--border); z-index: 50; display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .sidebar { width: 260px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; z-index: 60; transition: transform 0.3s ease; }
        .nav-item { padding: 14px; margin-bottom: 8px; border-radius: 10px; cursor: pointer; color: #94a3b8; transition: 0.2s; display: flex; align-items: center; gap: 12px; font-weight: 500; }
        .nav-item.active { background: var(--accent); color: white; }
        .main { flex: 1; padding: 80px 20px 20px 20px; overflow-y: auto; position: relative; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--bg-card); padding: 20px; border-radius: 16px; border: 1px solid var(--border); margin-bottom: 20px; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-primary { background: var(--accent); color: white; }
        input { width: 100%; padding: 12px; background: #0b0e14; border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 10px; }

        /* PREMIUM PLAN CARD */
        .premium-plan { background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; transition: 0.3s; display: flex; flex-direction: column; }
        .premium-plan:hover { transform: translateY(-5px); border-color: var(--accent); }
        .plan-hero { width: 100%; height: 150px; object-fit: cover; }
        .plan-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .plan-title { font-size: 1.3rem; font-weight: 700; color: white; margin-bottom: 5px; }
        .plan-price { font-size: 2rem; font-weight: 800; color: var(--accent); margin: 5px 0 15px 0; }
        .plan-desc { color: #94a3b8; font-size: 0.9rem; margin-bottom: 15px; white-space: pre-wrap; flex: 1; }

        @media (max-width: 768px) {
            .sidebar { position: fixed; top: 0; bottom: 0; left: 0; transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>

    <div class="mobile-header">
        <div onclick="document.querySelector('.sidebar').classList.toggle('open')" style="font-size:1.5rem; color:white;"><i class="fa-solid fa-bars"></i></div>
        <div style="font-weight:800; font-size:1.2rem; color:white;">Billify<span style="color:var(--accent)">Pro</span></div>
        <div></div>
    </div>

    <div class="sidebar">
        <div class="nav-item active" onclick="nav('subs')">üíé Subscriptions</div>
        <div class="nav-item" onclick="nav('create')">üöÄ Launch Free</div>
        <div class="nav-item" onclick="nav('history')">üåê Websites</div>
        <div class="nav-item" onclick="nav('settings')">üë§ Profile</div>
    </div>

    <div class="main">
        
        <!-- 1. PLANS -->
        <div id="pg-subs" class="page active">
            <h2>Premium Plans</h2>
            <div id="dynamic-plans" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px;"></div>
            <h3 style="margin-top:30px;">Active</h3>
            <div id="active-subs-container"><p style="color:#64748b">Loading...</p></div>
        </div>

        <!-- 2. CREATE FREE (AUTOMATED) -->
        <div id="pg-create" class="page">
            <div class="card" style="max-width:500px; margin:auto;">
                <h2>Free Website</h2>
                <div id="free-status-box"></div>
                <div id="create-form">
                    <input id="free-name" placeholder="Website Name">
                    <button class="btn-primary btn" onclick="createFree()">Launch Instantly ‚ö°</button>
                </div>
            </div>
        </div>

        <!-- 3. PROFILE (With Payment Name) -->
        <div id="pg-settings" class="page">
            <div class="card" style="max-width:500px;">
                <h3>Profile</h3>
                <label style="color:#94a3b8">Name</label><input id="s-name" placeholder="Name">
                <label style="color:#94a3b8">Mobile</label><input id="s-mobile" placeholder="Mobile">
                <label style="color:#94a3b8">Email</label><input id="s-email" placeholder="Email">
                <label style="color:var(--accent)">Payment App Name (For Verification)</label>
                <input id="s-payname" placeholder="e.g. Rahul (GPay)" style="border-color:var(--accent)">
                <button class="btn-primary btn" onclick="saveProf()">Save</button>
            </div>
        </div>

        <div id="pg-history" class="page"><h2>Websites</h2><div id="hist-list"></div></div>
    </div>

    <!-- BUY MODAL -->
    <div id="buy-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:100; align-items:center; justify-content:center; padding:20px;">
        <div class="card" style="width:100%; max-width:400px; max-height:90vh; overflow-y:auto;">
            <div id="step-1">
                <h3>Details</h3>
                <p>Plan: <b id="m-plan" style="color:var(--accent)"></b> ‚Çπ<b id="m-price"></b></p>
                <input id="m-site" placeholder="Website Name">
                <input id="m-mobile" placeholder="Mobile">
                <button class="btn-primary btn" onclick="toStep2()">Next</button> 
                <button class="btn" style="background:transparent; border:1px solid #555" onclick="closeModal()">Cancel</button>
            </div>
            <div id="step-2" style="display:none;">
                <h3>Pay</h3>
                <img id="qr-img" style="width:200px; display:block; margin:auto; border-radius:10px;">
                <p style="text-align:center">Pay ‚Çπ<span id="m-price-2"></span></p>
                <label style="color:#94a3b8">Payer Name</label><input id="m-payer" placeholder="Your Name">
                <label style="color:#94a3b8">Txn ID</label><input id="m-txn" placeholder="UTR">
                <button class="btn-primary btn" style="background:var(--success)" onclick="pay()">Submit Order</button> 
                <button class="btn" style="background:transparent; border:1px solid #555" onclick="closeModal()">Back</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCX5qpT_ytgJjRk21-VWZ-Ndhbq0hhjXYo", authDomain: "fir-integration-61a1f.firebaseapp.com", databaseURL: "https://fir-integration-61a1f-default-rtdb.firebaseio.com", projectId: "fir-integration-61a1f", storageBucket: "fir-integration-61a1f.firebasestorage.app", messagingSenderId: "178334018866", appId: "1:178334018866:web:ef78bc307549639d0ebb2b" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let uid = localStorage.getItem('bp_uid');
        if(!uid) { uid='u_'+Date.now(); localStorage.setItem('bp_uid', uid); }
        let tmp={};

        function nav(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('pg-'+id).classList.add('active');document.querySelector('.sidebar').classList.remove('open');}
        window.onload = () => { loadPlans(); loadSubs(); loadProf(); checkFree(); loadHist(); };

        // 1. AUTOMATED FREE SITE LOGIC
        async function createFree() {
            const n = document.getElementById('free-name').value;
            if(!n) return alert("Enter Name");

            const snap = await db.ref('settings/autoFreeUrl').get();
            const autoUrl = snap.val();

            if(autoUrl) {
                db.ref('users/'+uid).update({freeUsed:true});
                db.ref('websites').push({owner:uid, name:n, status:'live', url:autoUrl, createdAt:Date.now()});
                alert("Success! Your website is LIVE instantly.");
                nav('history');
            } else {
                db.ref('users/'+uid).update({freeUsed:true});
                db.ref('websites').push({owner:uid, name:n, status:'processing', createdAt:Date.now()});
                alert("Request Sent! Admin will approve shortly (Auto-link not set).");
            }
        }

        function checkFree(){
            db.ref('users/'+uid).on('value',s=>{
                if(s.val()&&s.val().freeUsed){
                    document.getElementById('free-status-box').innerHTML="<div style='color:orange; background:rgba(255,165,0,0.1); padding:10px; border-radius:5px;'>Limit Reached</div>";
                    document.getElementById('create-form').style.display='none';
                } else {
                    document.getElementById('free-status-box').innerHTML="<div style='color:#4ade80; background:rgba(74,222,128,0.1); padding:10px; border-radius:5px;'>1 Free Credit Available</div>";
                    document.getElementById('create-form').style.display='block';
                }
            });
        }

        // 2. PREMIUM PLANS
        function loadPlans() {
            db.ref('plans').on('value',s=>{
                const d=document.getElementById('dynamic-plans'); d.innerHTML='';
                if(s.exists()) s.forEach(c=>{
                    const p=c.val();
                    d.innerHTML+=`<div class="premium-plan">
                        <img src="${p.img||'https://via.placeholder.com/300x150'}" class="plan-hero">
                        <div class="plan-body">
                            <div class="plan-title">${p.name}</div>
                            <div class="plan-price">‚Çπ${p.price}</div>
                            <div class="plan-desc">${p.desc||''}</div>
                            <button class="btn-primary btn" onclick="checkProfileAndBuy('${p.name}',${p.price},${p.days})">Select Plan</button>
                        </div>
                    </div>`;
                });
            });
        }

        // 3. PROFILE ENFORCEMENT
        async function checkProfileAndBuy(n, p, d) {
            const snap = await db.ref('users/'+uid+'/profile').get();
            const prof = snap.val();
            if(!prof || !prof.name || !prof.mobile || !prof.payName) {
                alert("Please fill your Name, Mobile, and Payment App Name in the Profile section first!");
                nav('settings');
            } else {
                buy(n, p, d);
            }
        }

        function saveProf(){
            db.ref('users/'+uid+'/profile').set({
                name:document.getElementById('s-name').value,
                email:document.getElementById('s-email').value,
                mobile:document.getElementById('s-mobile').value,
                payName:document.getElementById('s-payname').value
            }).then(()=>alert("Saved"));
        }
        function loadProf(){
            db.ref('users/'+uid+'/profile').once('value',s=>{
                const v=s.val();
                if(v){
                    document.getElementById('s-name').value=v.name||'';
                    document.getElementById('s-email').value=v.email||'';
                    document.getElementById('s-mobile').value=v.mobile||'';
                    document.getElementById('s-payname').value=v.payName||'';
                    // Auto-fill buy modal
                    document.getElementById('m-mobile').value=v.mobile||'';
                    document.getElementById('m-payer').value=v.payName||'';
                }
            });
        }

        // 4. BUY
        function buy(n,p,d){ tmp={n,p,d}; document.getElementById('m-plan').innerText=n; document.getElementById('m-price').innerText=p; document.getElementById('m-price-2').innerText=p; document.getElementById('buy-modal').style.display='flex'; document.getElementById('step-1').style.display='block'; document.getElementById('step-2').style.display='none'; }
        function toStep2(){ if(document.getElementById('m-site').value){ db.ref('settings/qrCodeUrl').once('value').then(s=>{ document.getElementById('qr-img').src=s.val()||""; document.getElementById('step-1').style.display='none'; document.getElementById('step-2').style.display='block'; }); } else alert("Site Name Required"); }
        function pay(){ if(document.getElementById('m-txn').value){ db.ref('subscriptions').push({uid:uid, planName:tmp.n, price:tmp.p, durationDays:tmp.d, websiteName:document.getElementById('m-site').value, mobile:document.getElementById('m-mobile').value, payerName:document.getElementById('m-payer').value, txnId:document.getElementById('m-txn').value, status:'pending'}).then(()=>{ closeModal(); alert("Order Sent"); }); } }
        function closeModal(){ document.getElementById('buy-modal').style.display='none'; }
        
        function loadSubs(){ db.ref('subscriptions').orderByChild('uid').equalTo(uid).on('value',s=>{ const a=document.getElementById('active-subs-container'); a.innerHTML=''; s.forEach(c=>{ const v=c.val(); if(v.status==='active'){ const d=Math.ceil((v.expiryDate-Date.now())/86400000); if(d>0) a.innerHTML+=`<div class="card" style="border:1px solid var(--success)"><h3>${v.planName}</h3><p>${v.websiteName}</p><b>${d} Days Left</b><a href="${v.websiteUrl}" target="_blank" style="display:block;margin-top:5px;color:var(--success)">OPEN SITE</a></div>`; } }); }); }
        function loadHist(){ db.ref('websites').orderByChild('owner').equalTo(uid).on('value',s=>{ const l=document.getElementById('hist-list'); l.innerHTML=''; s.forEach(c=>{ const w=c.val(); const lnk=w.status==='live'?`<a href="${w.url}" target="_blank" style="color:var(--success)">OPEN</a>`:`Processing`; l.innerHTML+=`<div class="card"><b>${w.name}</b> <span style="float:right">${lnk}</span></div>`; }); }); }
    </script>
</body>
</html>


